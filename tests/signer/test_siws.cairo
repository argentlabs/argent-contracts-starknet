use argent::signer::signer_signature::{Ed25519Signature, Ed25519Signer, SIWSSignature, SignerSignature};
use argent::signer::siws::is_valid_siws_signature;
use core::traits::TryInto;
use garaga::ec_ops::{DerivePointFromXHint, G1Point, G1PointTrait, MSMHint, ec_safe_add, msm_g1};
use garaga::signatures::eddsa_25519::{EdDSASignature, EdDSASignatureWithHint};

#[test]
fn test_siws_signature_validation() {
    let pubkey: u256 = 0x76e70af44d520a839a44156248699346911e4a87efd153df694ef4a188a60c5b;
    let domain: Span<u8> = array![
        'h', 't', 't', 'p', 's', ':', '/', '/', 'c', 'a', 'r', 't', 'r', 'i', 'd', 'g', 'e', '.', 'g', 'g',
    ]
        .span();
    let hash: felt252 = 0x3d12d63bd7c309c264802ea127085b8ccd0b25e256311352c9b975c6e9977f3;
    let signer = Ed25519Signer { pubkey: pubkey.try_into().expect('ed25519 zero') };
    let mut signature_hint = get_signature_hint();
    let signature_with_hint = Serde::<EdDSASignatureWithHint>::deserialize(ref signature_hint).expect('deserialize failed');
    let signature = SIWSSignature {
        domain, signature_with_hint,
    };

    assert(is_valid_siws_signature(hash, signer, signature), 'Statement validation failed');
}
// === SIWS Test Values ===

// Public Key (Hex): 0x76e70af44d520a839a44156248699346911e4a87efd153df694ef4a188a60c5b
// Secret Key (Hex):
// 0x5652db16072844eaf9d0795d3d2a7a58fd98c600df6f535ea60768c14a9a10a60fb583db624d09d8e19a8a5bc33176a5005f3d4dd496d762630e07a320af0c63

// Message:
// https://cartridge.gg wants you to sign in with your Solana account:
// 919Sjn6pmyPavuzXHidYWxuh6xKTHYyEUXuVcYnsrCp2

// Authorize Controller session with hash: 0x3d12d63bd7c309c264802ea127085b8ccd0b25e256311352c9b975c6e9977f3

// Signature (Base58):
// 5xFDgX19fmWMPK8R7pLPR5WtPUPuarYKPxLbZdU4TUZ8KVSvgDX5aDwEy1EySHN1ipDNf2xTQc69cs6tWXc7mFJM
// Signature r (Hex): 0xf7b595899ccc59a4ebf356147a1f75b14ca6481cf565277ed2f62605fa744700
// Signature s (Hex): 0x25ac25b60801c292ef7834cb4a86f2f92c22b67e394e29a9f807fe3065f5bf06

fn get_signature_hint() -> Span<felt252> {
    array![
        0x5b8204e9d20873d973f7c1c8a425d6bb,
        0xf6750ad2d677bf3e525f77639fd6ca2e,
        0xd059bd83dc3e420598fb7261cdeecd34,
        0x405f311253676e7efd4c5beeb67a700,
        0x469369486215449a830a524df40ae776,
        0x5b0ca688a1f44e69df53d1ef874a1e91,
        0xdb,
        0x68,
        0x74,
        0x74,
        0x70,
        0x73,
        0x3a,
        0x2f,
        0x2f,
        0x63,
        0x61,
        0x72,
        0x74,
        0x72,
        0x69,
        0x64,
        0x67,
        0x65,
        0x2e,
        0x67,
        0x67,
        0x20,
        0x77,
        0x61,
        0x6e,
        0x74,
        0x73,
        0x20,
        0x79,
        0x6f,
        0x75,
        0x20,
        0x74,
        0x6f,
        0x20,
        0x73,
        0x69,
        0x67,
        0x6e,
        0x20,
        0x69,
        0x6e,
        0x20,
        0x77,
        0x69,
        0x74,
        0x68,
        0x20,
        0x79,
        0x6f,
        0x75,
        0x72,
        0x20,
        0x53,
        0x6f,
        0x6c,
        0x61,
        0x6e,
        0x61,
        0x20,
        0x61,
        0x63,
        0x63,
        0x6f,
        0x75,
        0x6e,
        0x74,
        0x3a,
        0xa,
        0x39,
        0x31,
        0x39,
        0x53,
        0x6a,
        0x6e,
        0x36,
        0x70,
        0x6d,
        0x79,
        0x50,
        0x61,
        0x76,
        0x75,
        0x7a,
        0x58,
        0x48,
        0x69,
        0x64,
        0x59,
        0x57,
        0x78,
        0x75,
        0x68,
        0x36,
        0x78,
        0x4b,
        0x54,
        0x48,
        0x59,
        0x79,
        0x45,
        0x55,
        0x58,
        0x75,
        0x56,
        0x63,
        0x59,
        0x6e,
        0x73,
        0x72,
        0x43,
        0x70,
        0x32,
        0xa,
        0xa,
        0x41,
        0x75,
        0x74,
        0x68,
        0x6f,
        0x72,
        0x69,
        0x7a,
        0x65,
        0x20,
        0x43,
        0x6f,
        0x6e,
        0x74,
        0x72,
        0x6f,
        0x6c,
        0x6c,
        0x65,
        0x72,
        0x20,
        0x73,
        0x65,
        0x73,
        0x73,
        0x69,
        0x6f,
        0x6e,
        0x20,
        0x77,
        0x69,
        0x74,
        0x68,
        0x20,
        0x68,
        0x61,
        0x73,
        0x68,
        0x3a,
        0x20,
        0x30,
        0x78,
        0x33,
        0x64,
        0x31,
        0x32,
        0x64,
        0x36,
        0x33,
        0x62,
        0x64,
        0x37,
        0x63,
        0x33,
        0x30,
        0x39,
        0x63,
        0x32,
        0x36,
        0x34,
        0x38,
        0x30,
        0x32,
        0x65,
        0x61,
        0x31,
        0x32,
        0x37,
        0x30,
        0x38,
        0x35,
        0x62,
        0x38,
        0x63,
        0x63,
        0x64,
        0x30,
        0x62,
        0x32,
        0x35,
        0x65,
        0x32,
        0x35,
        0x36,
        0x33,
        0x31,
        0x31,
        0x33,
        0x35,
        0x32,
        0x63,
        0x39,
        0x62,
        0x39,
        0x37,
        0x35,
        0x63,
        0x36,
        0x65,
        0x39,
        0x39,
        0x37,
        0x37,
        0x66,
        0x33,
        0x6527f01a1b22082226255521,
        0xb3abec27baa84849e36a60c0,
        0x243a5e853bfe0d75,
        0x0,
        0xc7c1738ce1a6122114fc99f3,
        0x68cceaa9bcff9c89e332a0ce,
        0x61f7f54e605f9e08,
        0x0,
        0xe3e8b10b9547d75b2ff158b7,
        0x919ded7970ec406816bdb545,
        0x13813caa6a2f723a,
        0x0,
        0x699383f10dad6f58224be547,
        0x26f057194587b210ccc48ce5,
        0x3aa0fdfc176c47e0,
        0x0,
        0xbc7eb178011a55c04b07f5f6,
        0xf4e6d26dd86d1e113edccfce,
        0x69cad09389674e0e,
        0x0,
        0xc376da7eaaadcdc95570244e,
        0x177048916a5fcfece9292f65,
        0x6b1a14b28d42409a,
        0x0,
        0x5,
        0x9e83a4e52a4322af531b5293,
        0xff9e912ad352970b9596b7e1,
        0x33f2826933936c26,
        0x0,
        0x399172108a0d596c8f16e7a2,
        0x2d6dda819c1b83e6894ad2e7,
        0x2224529e9d10d1f2,
        0x0,
        0x42bf7c0964e39e361ae650a3,
        0x1b920deff552035a31affb71,
        0x2bcfa447e5898721,
        0x0,
        0xcda8314aca37d34d36bb7c2e,
        0xaf4731e0f6d85dba9728f42,
        0x285796e11d636b1a,
        0x0,
        0xa29ff969d1c61490caaafad6,
        0x8a26f4c76e9d0ca8bbaca76b,
        0x443646af489623ab,
        0x0,
        0x6,
        0xe1c0428e4e48c8a83e031fa0,
        0xe66fe4dbcb0a5651cb2b742b,
        0x17a9a78295bd8775,
        0x0,
        0x9c0aafcd5548f6b5977aa308,
        0x2dd270065dcc23b080097bd4,
        0x21709f09deff7912,
        0x0,
        0xde6d0889d9bb24f24cd28163,
        0x1346fc65e4e42e634a0101b5,
        0x774867d6bc0626cb,
        0x0,
        0x83d0be283ce484098c703caa,
        0xa54ca747870ef8083cd90815,
        0x6cf206f962203e7a,
        0x0,
        0x3766234ac1acebdcf6861039,
        0x1d334292331cb66ed8a8f96,
        0x45940133cbb735ba,
        0x0,
        0x1,
        0x0,
        0x0,
        0x0,
        0x6,
        0x6a2b2d42b471c8b0ae178bc9,
        0xf0b8efa3c9b520e4e6ef2948,
        0x7a6c9017f397f871,
        0x0,
        0xcaabf9a32d940bba5d89d9ae,
        0x161ad5ddd619c3dd08613342,
        0x4a24005a5b8e4278,
        0x0,
        0xbad1f4cf779781f98d477ac7,
        0xee5b8e45e15099d885f481c1,
        0x15598b04799ce5fd,
        0x0,
        0x8e51701b5df9a4ad433467d2,
        0x645ebee8d6ac1a08eb5d6f59,
        0x1981a7c396b2872a,
        0x0,
        0x9e115f498eee66c63a67814b,
        0x9bf4167022803a7dd1d961a4,
        0x1164d002f005c511,
        0x0,
        0xd961c48d7e0998a97d98c998,
        0x1d9b44682887b1ab2d64f5b1,
        0x7e223a94af09f258,
        0x0,
        0x9,
        0x4cb17e1059daf22803176e6,
        0xb44a5867a9c340a60778c274,
        0x7eba00f7e51004ba,
        0x0,
        0x12138a244e57df94b45501db,
        0x3ef0eb5e69de1b25bbd34dbb,
        0x586782067bde32ae,
        0x0,
        0xe6a5fde45fbac2c98c9ea28f,
        0xf997d4452f77396db3d57f34,
        0x1f78b42ae11c893c,
        0x0,
        0xc4228f2a35b8cf24a69bda85,
        0xd31fcc75d2a40297e5f10dd9,
        0x299d24ea0c38615d,
        0x0,
        0x4603ffbc2c37eab2a0cedb31,
        0xb4deab5ed8ed7f70933c9eb3,
        0x211b3071aac7bf6d,
        0x0,
        0x86532b901c267a283c30988e,
        0x303fe190dab52f0a224a0a4,
        0x5481add2cea3780e,
        0x0,
        0x9075e91fe9566598852c53ea,
        0xd6e48854e88a35dea891be72,
        0x4a40b3cd07d9fd60,
        0x0,
        0x3766234ac1acebdcf6861039,
        0x1d334292331cb66ed8a8f96,
        0x45940133cbb735ba,
        0x0,
        0x1,
        0x0,
        0x0,
        0x0,
        0x79d5f107efb442be2074b162,
        0xf5e80f71987a5dd405cfbe70,
        0x26e356ce3f74d68e,
        0x0,
        0x0,
        0xc525927569a437648835b64733352e47,
        0x7ff16bddc95ac33eba05195687ac53e,
        0xa55e57950e221f0786036884d69d31c,
        0x3a2956d4df074c07827d7a2b95ac1135,
    ].span()
}
